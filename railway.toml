# Railway configuration for MCP server + worker
# Secrets (GITHUB_PAT, OPENAI_API_KEY, DATABASE_URL, QDRANT_URL, QDRANT_API_KEY)
# should be set in the Railway dashboard or via service variables.
# For QDRANT_URL, open the Qdrant service Connect tab and copy the HTTP endpoint (port 6333);
# set that value on both services (internal domain preferred; public HTTPS works if enabled).

[build]
# Use the repo Dockerfile for both services
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
# MCP server (FastMCP SSE) entrypoint - Long-running Docker process
# NOT serverless: serverless functions kill streams after ~60s
startCommand = "python -m server.main"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 5
numReplicas = 1
# Ensure long-running process mode (not serverless)
sleepApplication = false

[deploy.env]
PORT = "8000"
GITHUB_OWNER = "anirudhadasgupta"
EMBEDDING_MODEL = "text-embedding-3-large"
EMBEDDING_DIMS = "1024"
MAX_FILE_BYTES = "250000"
EXCLUDE_GLOBS = "node_modules/**,dist/**,build/**,.git/**,vendor/**,**/*.min.js,**/*.lock"
# Heartbeat interval in seconds (keep connections alive)
HEARTBEAT_INTERVAL_SECONDS = "30"

[services.worker]
# Background indexer worker shares the same image
startCommand = "python -m server.worker"
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 5

[services.worker.env]
PORT = "8000"
GITHUB_OWNER = "anirudhadasgupta"
EMBEDDING_MODEL = "text-embedding-3-large"
EMBEDDING_DIMS = "1024"
MAX_FILE_BYTES = "250000"
EXCLUDE_GLOBS = "node_modules/**,dist/**,build/**,.git/**,vendor/**,**/*.min.js,**/*.lock"
